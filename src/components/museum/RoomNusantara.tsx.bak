"use client";

import React, { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import useIsMobile from "@/hooks/useIsMobile";
import useParallax from "@/hooks/useParallax";
import { BlurText, FadeIn } from "@/components/ui/TextEffects";
import { TiltCard, SpotlightCard, ParticleField } from "@/components/ui/CardEffects";

interface Region {
  id: string;
  name: string;
  art: string;
  desc: string;
  image: string;
  icon: React.ReactNode;
}

const regions: Region[] = [
  {
    id: "sumatera",
    name: "Sumatera",
    art: "Ulos & Songket",
    desc: "Tenun tradisional Batak dan Palembang yang kaya makna filosofis.",
    image: "/images/museum/nusantara/ulos-sumatera.webp",
    icon: (
      <svg viewBox="0 0 28 28" className="w-7 h-7">
        <path d="M14 4 L8 10 L6 18 L10 24 L18 24 L22 18 L20 10 Z" fill="none" stroke="#C6A75E" strokeWidth="1" />
        <path d="M10 12 L14 10 L18 12 M10 16 L14 18 L18 16" stroke="#C6A75E" strokeWidth="0.6" opacity="0.5" />
      </svg>
    ),
  },
  {
    id: "jawa",
    name: "Jawa",
    art: "Batik & Wayang",
    desc: "Warisan UNESCO batik tulis dan seni pertunjukan wayang kulit.",
    image: "/images/museum/nusantara/batik-jawa.webp",
    icon: (
      <svg viewBox="0 0 28 28" className="w-7 h-7">
        <circle cx="14" cy="10" r="4" fill="none" stroke="#C6A75E" strokeWidth="1" />
        <path d="M8 18 Q14 14 20 18 L18 26 L10 26 Z" fill="none" stroke="#C6A75E" strokeWidth="0.8" />
        <path d="M12 8 L14 4 L16 8" stroke="#C6A75E" strokeWidth="0.6" fill="none" />
      </svg>
    ),
  },
  {
    id: "bali",
    name: "Bali",
    art: "Ukiran & Lukisan",
    desc: "Seni ukir kayu dan lukisan tradisional Ubud yang mendunia.",
    image: "/images/museum/nusantara/ukiran-bali.webp",
    icon: (
      <svg viewBox="0 0 28 28" className="w-7 h-7">
        <path d="M14 4 L20 10 L18 20 L14 24 L10 20 L8 10 Z" fill="none" stroke="#C6A75E" strokeWidth="1" />
        <circle cx="14" cy="14" r="3" fill="#C6A75E" opacity="0.2" />
        <path d="M14 8 L14 20 M10 14 L18 14" stroke="#C6A75E" strokeWidth="0.5" opacity="0.4" />
      </svg>
    ),
  },
  {
    id: "kalimantan",
    name: "Kalimantan",
    art: "Seni Dayak",
    desc: "Manik-manik, ukiran, dan motif tradisional suku Dayak.",
    image: "/images/museum/nusantara/seni-dayak.webp",
    icon: (
      <svg viewBox="0 0 28 28" className="w-7 h-7">
        <rect x="8" y="6" width="12" height="16" rx="2" fill="none" stroke="#C6A75E" strokeWidth="1" />
        <circle cx="14" cy="11" r="2" fill="#C6A75E" opacity="0.3" />
        <path d="M10 16 L18 16 M10 19 L18 19" stroke="#C6A75E" strokeWidth="0.6" opacity="0.5" />
      </svg>
    ),
  },
  {
    id: "sulawesi",
    name: "Sulawesi",
    art: "Toraja & Tenun",
    desc: "Seni ukir Toraja dan tenun Bugis-Makassar yang eksotis.",
    image: "/images/museum/nusantara/toraja-sulawesi.webp",
    icon: (
      <svg viewBox="0 0 28 28" className="w-7 h-7">
        <path d="M10 6 L18 6 L20 12 L18 20 L14 24 L10 20 L8 12 Z" fill="none" stroke="#C6A75E" strokeWidth="1" />
        <path d="M12 10 L16 10 L16 16 L12 16 Z" fill="#C6A75E" opacity="0.15" />
      </svg>
    ),
  },
  {
    id: "papua",
    name: "Papua",
    art: "Seni Kayu & Noken",
    desc: "Ukiran Asmat dan tas Noken, simbol kehidupan Papua.",
    image: "/images/museum/nusantara/noken-papua.webp",
    icon: (
      <svg viewBox="0 0 28 28" className="w-7 h-7">
        <path d="M6 14 Q10 6 18 8 Q24 10 22 18 Q20 24 14 24 Q8 24 6 14 Z" fill="none" stroke="#C6A75E" strokeWidth="1" />
        <path d="M12 12 L16 12 M10 16 L18 16 M12 20 L16 20" stroke="#C6A75E" strokeWidth="0.5" opacity="0.4" />
      </svg>
    ),
  },
];

export default function RoomNusantara() {
  const [activeRegion, setActiveRegion] = useState<Region | null>(null);
  const isMobile = useIsMobile();
  const registerParallax = useParallax(!isMobile);

  return (
    <section className="room room-4 flex items-center justify-center room-vignette relative">
      {/* Deep warm background */}
      <div className="absolute inset-0 bg-gradient-to-br from-[#0F3B2E]/20 via-[#1A1008] to-[#2C1A12]" />

      {/* Ambient particles */}
      <ParticleField count={isMobile ? 10 : 20} color="#0F3B2E" minSize={1} maxSize={3} speed="slow" direction="random" />

      {/* Ambient map glow — parallax */}
      <div className="absolute inset-0 pointer-events-none"
        ref={registerParallax(-12, -12)}
        style={{ willChange: "transform" }}
      >
        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[700px] h-[500px] bg-[#0F3B2E] opacity-[0.06] blur-[120px] rounded-full" />
      </div>

      <div className="relative z-10 px-4 sm:px-6 max-w-6xl mx-auto w-full py-8 sm:py-0">
        {/* Header */}
        <motion.div
          className="text-center mb-4 sm:mb-12"
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          transition={{ duration: 1 }}
          viewport={{ once: true }}
        >
          <span
            className="text-[9px] sm:text-xs tracking-[0.4em] uppercase text-[#C6A75E]/50 block mb-2 sm:mb-4"
            style={{ fontFamily: "var(--font-inter)" }}
          >
            Interactive Map
          </span>
          <BlurText
            text="Nusantara"
            className="text-xl sm:text-3xl md:text-5xl lg:text-6xl font-bold text-[#C6A75E] text-glow-gold mb-2 sm:mb-4"
            style={{ fontFamily: "var(--font-cinzel)" }}
            delay={0.2}
          />
          <p
            className="text-xs sm:text-base md:text-lg text-[#F5EBDD]/50 max-w-xl mx-auto"
            style={{ fontFamily: "var(--font-cormorant)" }}
          >
            Jelajahi kekayaan seni dari setiap penjuru kepulauan
          </p>
        </motion.div>

        {/* Interactive Map — SVG (desktop) */}
        <div className="relative w-full max-w-4xl mx-auto">
          <motion.svg
            viewBox="0 0 1000 400"
            className="w-full h-auto hidden sm:block"
            initial={{ opacity: 0 }}
            whileInView={{ opacity: 1 }}
            transition={{ duration: 1.5 }}
            viewport={{ once: true }}
          >
            {/* Sumatera */}
            <motion.path
              d="M120,80 L160,60 L200,80 L220,140 L200,220 L170,260 L130,240 L100,180 L90,120 Z"
              fill={activeRegion?.id === "sumatera" ? "#C6A75E" : "#2C1A12"}
              stroke="#C6A75E"
              strokeWidth="1.5"
              className="cursor-pointer transition-colors duration-500"
              style={{ filter: activeRegion?.id === "sumatera" ? "drop-shadow(0 0 20px rgba(198,167,94,0.5))" : "none" }}
              onMouseEnter={() => setActiveRegion(regions[0])}
              onMouseLeave={() => setActiveRegion(null)}
              whileHover={{ scale: 1.03 }}
            />
            {/* Jawa */}
            <motion.path
              d="M250,260 L320,250 L400,255 L480,260 L500,270 L460,285 L380,290 L300,285 L260,275 Z"
              fill={activeRegion?.id === "jawa" ? "#C6A75E" : "#2C1A12"}
              stroke="#C6A75E"
              strokeWidth="1.5"
              className="cursor-pointer transition-colors duration-500"
              style={{ filter: activeRegion?.id === "jawa" ? "drop-shadow(0 0 20px rgba(198,167,94,0.5))" : "none" }}
              onMouseEnter={() => setActiveRegion(regions[1])}
              onMouseLeave={() => setActiveRegion(null)}
              whileHover={{ scale: 1.03 }}
            />
            {/* Bali + Nusa Tenggara */}
            <motion.path
              d="M520,265 L540,255 L560,260 L600,265 L620,270 L580,280 L550,278 L525,275 Z"
              fill={activeRegion?.id === "bali" ? "#C6A75E" : "#2C1A12"}
              stroke="#C6A75E"
              strokeWidth="1.5"
              className="cursor-pointer transition-colors duration-500"
              style={{ filter: activeRegion?.id === "bali" ? "drop-shadow(0 0 20px rgba(198,167,94,0.5))" : "none" }}
              onMouseEnter={() => setActiveRegion(regions[2])}
              onMouseLeave={() => setActiveRegion(null)}
              whileHover={{ scale: 1.03 }}
            />
            {/* Kalimantan */}
            <motion.path
              d="M280,90 L360,70 L440,80 L470,130 L460,200 L420,240 L350,250 L280,230 L250,180 L260,120 Z"
              fill={activeRegion?.id === "kalimantan" ? "#C6A75E" : "#2C1A12"}
              stroke="#C6A75E"
              strokeWidth="1.5"
              className="cursor-pointer transition-colors duration-500"
              style={{ filter: activeRegion?.id === "kalimantan" ? "drop-shadow(0 0 20px rgba(198,167,94,0.5))" : "none" }}
              onMouseEnter={() => setActiveRegion(regions[3])}
              onMouseLeave={() => setActiveRegion(null)}
              whileHover={{ scale: 1.03 }}
            />
            {/* Sulawesi */}
            <motion.path
              d="M520,100 L560,80 L580,110 L570,160 L590,190 L560,220 L540,200 L520,170 L510,140 Z"
              fill={activeRegion?.id === "sulawesi" ? "#C6A75E" : "#2C1A12"}
              stroke="#C6A75E"
              strokeWidth="1.5"
              className="cursor-pointer transition-colors duration-500"
              style={{ filter: activeRegion?.id === "sulawesi" ? "drop-shadow(0 0 20px rgba(198,167,94,0.5))" : "none" }}
              onMouseEnter={() => setActiveRegion(regions[4])}
              onMouseLeave={() => setActiveRegion(null)}
              whileHover={{ scale: 1.03 }}
            />
            {/* Papua */}
            <motion.path
              d="M740,100 L800,80 L880,90 L920,120 L900,180 L850,220 L790,210 L740,170 L730,130 Z"
              fill={activeRegion?.id === "papua" ? "#C6A75E" : "#2C1A12"}
              stroke="#C6A75E"
              strokeWidth="1.5"
              className="cursor-pointer transition-colors duration-500"
              style={{ filter: activeRegion?.id === "papua" ? "drop-shadow(0 0 20px rgba(198,167,94,0.5))" : "none" }}
              onMouseEnter={() => setActiveRegion(regions[5])}
              onMouseLeave={() => setActiveRegion(null)}
              whileHover={{ scale: 1.03 }}
            />

            {/* Connection lines */}
            {[
              "M170,240 Q220,250 260,260",
              "M460,200 Q470,230 480,255",
              "M500,270 Q510,267 520,265",
              "M440,130 Q480,115 520,110",
              "M580,160 Q660,140 740,120",
            ].map((d, i) => (
              <motion.path
                key={i}
                d={d}
                stroke="#C6A75E"
                strokeWidth="0.5"
                strokeDasharray="4 4"
                fill="none"
                opacity={0.2}
                initial={{ pathLength: 0 }}
                whileInView={{ pathLength: 1 }}
                transition={{ duration: 2, delay: 0.5 + i * 0.2 }}
                viewport={{ once: true }}
              />
            ))}

            {/* Island labels */}
            {[
              { x: 150, y: 160, label: "Sumatera" },
              { x: 375, y: 275, label: "Jawa" },
              { x: 565, y: 270, label: "Bali" },
              { x: 365, y: 155, label: "Kalimantan" },
              { x: 550, y: 155, label: "Sulawesi" },
              { x: 830, y: 155, label: "Papua" },
            ].map((l, i) => (
              <text
                key={i}
                x={l.x}
                y={l.y}
                fill="#C6A75E"
                fontSize="11"
                textAnchor="middle"
                opacity={0.4}
                style={{ fontFamily: "var(--font-inter)" }}
              >
                {l.label}
              </text>
            ))}
          </motion.svg>

          {/* Region popup card — with image */}
          <AnimatePresence>
            {activeRegion && (
              <motion.div
                className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20"
                initial={{ opacity: 0, scale: 0.9, y: 10 }}
                animate={{ opacity: 1, scale: 1, y: 0 }}
                exit={{ opacity: 0, scale: 0.9, y: 10 }}
                transition={{ duration: 0.3 }}
              >
                <div
                  className="bg-[#1A1008]/95 backdrop-blur-md border border-[#C6A75E]/40 min-w-[300px] shadow-2xl overflow-hidden"
                  style={{ boxShadow: "0 0 60px rgba(198,167,94,0.1)" }}
                >
                  {/* Region artwork image */}
                  <div className="relative w-full h-32 bg-[#2C1A12]">
                    <img src={activeRegion.image} alt={activeRegion.name}
                      className="absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-500"
                      onLoad={(e) => { (e.target as HTMLImageElement).style.opacity = "0.8"; }}
                      onError={(e) => { (e.target as HTMLImageElement).style.display = "none"; }}
                    />
                    <div className="absolute inset-0 bg-gradient-to-t from-[#1A1008] to-transparent" />
                    <div className="absolute bottom-3 left-4 flex items-center gap-2">
                      {activeRegion.icon}
                      <h3 className="text-lg font-semibold text-[#C6A75E]"
                        style={{ fontFamily: "var(--font-cinzel)" }}>
                        {activeRegion.name}
                      </h3>
                    </div>
                  </div>
                  <div className="px-6 py-4">
                    <span className="text-xs text-[#C6A75E]/60 tracking-widest uppercase block mb-2"
                      style={{ fontFamily: "var(--font-inter)" }}>
                      {activeRegion.art}
                    </span>
                    <p className="text-sm text-[#F5EBDD]/60 leading-relaxed"
                      style={{ fontFamily: "var(--font-inter)" }}>
                      {activeRegion.desc}
                    </p>
                  </div>
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>

        {/* Mobile: Region cards grid with TiltCard */}
        {isMobile && (
          <div className="grid grid-cols-3 gap-2 mt-4 sm:hidden">
            {regions.map((region, i) => (
              <FadeIn key={region.id} direction="up" delay={i * 0.1} duration={0.5}>
                <TiltCard maxTilt={0}>
                  <SpotlightCard
                    className="border border-[#C6A75E]/20 bg-[#1A1008]/60 backdrop-blur-sm hover:border-[#C6A75E]/40 transition-all duration-500 overflow-hidden"
                    spotlightColor="rgba(15, 59, 46, 0.1)"
                  >
                    {/* Tiny region image */}
                    <div className="relative w-full h-14 bg-[#2C1A12]">
                      <img src={region.image} alt=""
                        className="absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-500"
                        onLoad={(e) => { (e.target as HTMLImageElement).style.opacity = "0.6"; }}
                        onError={(e) => { (e.target as HTMLImageElement).style.display = "none"; }}
                      />
                      <div className="absolute inset-0 bg-gradient-to-t from-[#1A1008] to-transparent" />
                    </div>
                    <div className="p-2">
                      <div className="flex items-center gap-1 mb-0.5">
                        {region.icon}
                        <h3 className="text-[10px] font-semibold text-[#C6A75E]"
                          style={{ fontFamily: "var(--font-cinzel)" }}>
                          {region.name}
                        </h3>
                      </div>
                      <p className="text-[8px] text-[#C6A75E]/50 tracking-wide uppercase"
                        style={{ fontFamily: "var(--font-inter)" }}>
                        {region.art}
                      </p>
                    </div>
                  </SpotlightCard>
                </TiltCard>
              </FadeIn>
            ))}
          </div>
        )}

        {/* Bottom tagline */}
        <motion.p
          className="text-center mt-4 sm:mt-12 text-[9px] sm:text-sm text-[#C6A75E]/30 tracking-widest"
          style={{ fontFamily: "var(--font-inter)" }}
          initial={{ opacity: 0 }}
          whileInView={{ opacity: 1 }}
          transition={{ delay: 1 }}
          viewport={{ once: true }}
        >
          Dari Sabang sampai Merauke — satu ekosistem kreatif
        </motion.p>
      </div>
    </section>
  );
}
